# Opening Line Generation Strategy

## Method: Random Stockfish Games

Lines are generated by playing many random games using Stockfish, starting from
a fixed opening position.

### How it works

1. **Pick a starting position** — e.g. after `1. e4 e5 2. Nf3 Nc6 3. Bc4` (Italian)
   or `1. e4 e5 2. Nf3 Nc6 3. d4` (Scotch).

2. **Branch from common Black replies** — for each opening, define 3-5 typical
   Black continuations (e.g. `3...Bc5`, `3...Nf6`, `3...d6`). Weight the main
   lines more heavily so they get more coverage.

3. **Play random games** — for each game:
   - Start from a randomly-chosen branch (weighted).
   - At each move, ask Stockfish for the top-N moves (`multipv=4`, `depth=10`).
   - Pick one at random, weighted heavily toward the top choice
     (weights: `[8, 4, 2, 1]` for ranks 1-4).
   - Continue until the target ply (e.g. 20 half-moves / 10 full moves).

4. **Repeat many times** — play 300 games to get broad coverage. Because moves
   are chosen randomly (with bias toward good moves), each game follows a
   different path through the opening tree.

5. **Deduplicate** — remove exact duplicate move sequences.

6. **Sort by similarity** — sort lines lexicographically by their UCI move
   sequence so that lines sharing a common prefix (same branch) are grouped
   together.

7. **Name and tag** — each line is named with:
   - Its branch (e.g. "Giuoco Piano", "Two Knights")
   - An eval tag based on the Stockfish score at the final position:
     - `Winning` (> +3.0)
     - `Clear Edge` (> +1.5)
     - `Slight Edge` (> +0.5)
     - `Equal` (-0.5 to +0.5)
     - `Tough` (< -0.5)
     - `Difficult` (< -1.5)

### Parameters

| Parameter     | Value | Purpose                               |
|--------------|-------|---------------------------------------|
| `DEPTH`      | 10    | Stockfish search depth per move       |
| `NUM_GAMES`  | 300   | Total random games to play            |
| `TARGET_PLY` | 20    | Max half-moves per game (~10 moves)   |
| `TOP_N`      | 4     | Candidate moves per position          |
| `seed`       | 42    | Random seed for reproducibility       |

### Generator script

```bash
uv run python scripts/generate_italian_lines.py > italian_lines.json
```

The JSON output is then converted into `scripts/add_italian.py` (or
`add_scotch.py`, etc.).

### Archive

Original hand-crafted scripts are saved in `scripts/archive/` (gitignored)
for reference.
